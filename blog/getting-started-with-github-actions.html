
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Gary Ewan Park - Getting started with GitHub Actions</title>
        <meta name="description" content="Ramblings and Ponderings of a Microsoft Fan Boy..." />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Gary Ewan Park" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Gary Ewan Park" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Gary Ewan Park" />
        <meta name="msapplication-tooltip" content="Gary Ewan Park" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Gary Ewan Park - Getting started with GitHub Actions" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.gep13.co.uk/blog/getting-started-with-github-actions" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Gary Ewan Park</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li>
<li><a href="/talks">Talks</a></li>
<li><a href="/blog">Archive</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/tags">Tags</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Getting started with GitHub Actions</h1>
    <div class="meta">        
Published on 14 December 2018<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/actions" class="btn btn-default btn-xs">actions</a>
                    <a role="button" href="/tags/automation" class="btn btn-default btn-xs">automation</a>
                    <a role="button" href="/tags/cake" class="btn btn-default btn-xs">cake</a>
                    <a role="button" href="/tags/github" class="btn btn-default btn-xs">github</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>On Wednesday evening, I got a very pleasant email from GitHub, telling me that I had been given access to the GitHub Actions Beta.  This is something that I have been looking forward to for a while now, ever since I signed up for it.  I am a big user of Continuous Integration Systems for building the various Open Source projects that I work on, but I really like the idea of doing smaller, precise actions, as a result of other &quot;things&quot; happening on a repository.</p>
<p>I was even more impatient to get started with the Beta when I saw <a href="https://twitter.com/devblackops">Brandon Olin</a> tweet this:</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Getting my feet wet with GitHub Actions and having some fun with psake.<br><br>Check out my generic psake task runner here: <a href="https://t.co/lNvKwmDasE">https://t.co/lNvKwmDasE</a><br><br>Still WIP but making progress. <a href="https://t.co/8tPnxxWmtR">pic.twitter.com/8tPnxxWmtR</a></p>&mdash; Brandon Olin (&#64;devblackops) <a href="https://twitter.com/devblackops/status/1072036355855671297?ref_src=twsrc%5Etfw">December 10, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>As I wanted to do the same thing for <a href="https://cakebuild.net/">Cake</a>.</p>
<div class="alert alert-info"><p><strong>NOTE:</strong></p>
<p>I have to give a huge thanks to Brandon for the work that he did in creating the psake GitHub Action, as I was able to use this as the starting point for Cake GitHub Action.</p>
</div>
<h2 id="getting-started">Getting Started</h2>
<p>There is some fairly comprehensive documentation on getting started with GitHub Actions on <a href="https://developer.github.com/actions">the site</a>, so I am not going to repeat that here, but rather focus on what was necessary to specifically get a Cake script executing as a result of a GitHub Action.</p>
<div class="alert alert-info"><p><strong>NOTE:</strong></p>
<p>In addition to the above documentation site, you can also find the source code for the out of the box actions on <a href="https://github.com/actions">GitHub</a>.</p>
</div>
<h2 id="docker-ftw">Docker FTW!</h2>
<p>The starting point for any new GitHub Action is a Dockerfile.  This is what is going to be used to actually execute the action.  In the case of the psake GitHub Action, it uses <a href="https://hub.docker.com/r/microsoft/powershell/">Microsoft's PowerShell Docker Image</a> as it already has PowerShell installed, so all that is left is to install and execute psake.  In the case of Cake, there is already an image on the Docker Hub that has <a href="https://hub.docker.com/r/cakebuild/cake">Cake</a> installed, and ready to be used.  As a result the <a href="https://github.com/gep13/cake-actions/blob/master/task/Dockerfile">Dockerfile</a> for the Cake GitHub Action is relatively straight forward:</p>
<div class="alert alert-info"><p><strong>NOTE:</strong></p>
<p>The following is likely to change.  What is shown here is from the initial proof of concept action, just to see how things work</p>
</div>
<pre><code class="language-shell">FROM cakebuild/cake:v0.30.0-2.1-sdk as base

FROM base as cake-build
LABEL &quot;com.github.actions.name&quot;         = &quot;Cake task&quot;
LABEL &quot;com.github.actions.description&quot;  = &quot;Run Cake task&quot;
LABEL &quot;com.github.actions.icon&quot;         = &quot;box&quot;
LABEL &quot;com.github.actions.color&quot;        = &quot;yellow&quot;

LABEL &quot;repository&quot; = &quot;https://github.com/gep13/cake-actions&quot;
LABEL &quot;homepage&quot;   = &quot;https://github.com/cake-build/cake&quot;
LABEL &quot;maintainer&quot; = &quot;Gary Ewan Park &lt;gep13&#64;gep13.co.uk&gt;&quot;

ADD entrypoint.sh  /entrypoint.sh

RUN chmod +x /entrypoint.sh

ENTRYPOINT [&quot;/entrypoint.sh&quot;]
</code></pre>
<p>All that is really being done here is specifying the base image to use, and then configuring the information about the image, and then adding the entry point for when the container is executed.</p>
<h2 id="entry-point">Entry Point</h2>
<p>With the Dockerfile defined, I then moved onto the entry point script for when the container is executed.  This ended up looking like the following:</p>
<pre><code class="language-shell">#!/bin/sh

set -eu

cake --version

cake $CAKE_SCRIPT --target=$*

exit $?
</code></pre>
<p>Now, this really needs some work in terms of error handling, etc, but again, just a proof of concept to show how things work.</p>
<p>Since Cake is already available on the Docker image, it can be invoked directly.  So the first thing that is being done in this shell script is to run <code>cake --version</code> so that information about what version of Cake is being used is output to the log.  After that, cake is being executed against a named script (which will be read from an Environment Variable <code>CAKE_SCRIPT</code>), and then a specific target (which will come from an argument specified in the workflow).</p>
<p>With both of those things created, the Cake GitHub Action is complete, and ready to be tested.  You can see the complete action <a href="https://github.com/gep13/cake-actions/tree/master/task">here</a>.</p>
<h2 id="creating-the-workflow">Creating the workflow</h2>
<p>During the beta, GitHub Actions are only available on private repositories, so I can't link to the example repository that I am using, but I will walk you through what I did.</p>
<ul>
<li>Open the GitHub repository, and click on the new Actions tab.</li>
<li>Click the <code>Create a new workflow</code> button.  This will create a file called <code>main.workflow</code> in the <code>.github</code> folder</li>
<li>Since we will be using a custom GitHub Action, switch away from the visual editor by clicking on <code>Edit new file</code></li>
<li>Enter the following</li>
</ul>
<pre><code class="language-shell">workflow &quot;New workflow&quot; {
  on = &quot;push&quot;
  resolves = [&quot;cake test&quot;]
}


action &quot;cake test&quot; {
    uses = &quot;gep13/cake-actions/task&#64;master&quot;

    env = {
        CAKE_SCRIPT = &quot;./build.cake&quot;
    }

    args =[&quot;Default&quot;]
}
</code></pre>
<ul>
<li>This defines a new <code>cake test</code> action, which is triggered when a push happens on the repository</li>
<li>This action uses the custom action located at <code>gep13/cake-actions/task&#64;master</code> <strong>NOTE:</strong> here master indicates that the contents of the current master branch should be used.  Once running properly, you are probably going to want to use a named tag, to pin to a specific version of the action, so that you know that is won't change over time.  For example, <code>gep13/cake-actions/task&#64;0.1.0</code></li>
<li>Then a new environment variable is defined called <code>CAKE_SCRIPT</code> with a value of <code>./build.cake</code>.  This correlates to a file called build.cake which needs to be located in the root of the repository where the action is being used</li>
<li>Finally, the arguments to pass into Cake are defined.  Here, we are setting this to Default.  When passed into Cake, this will be changed to <code>--target=Default</code>  <strong>NOTE:</strong> This part of the entrypoint.sh really needs some work, again, just a proof of concept</li>
<li>Save and commit the changes to the main.workflow</li>
<li>Now that these parts are in place, we need a build.cake file.  A simple one would be the following, which writes out Hello World! to the console output:</li>
</ul>
<pre><code class="language-shell">var target = Argument(&quot;target&quot;, &quot;Default&quot;);

Task(&quot;Default&quot;)
  .Does(() =&gt;
{
  Information(&quot;Hello World!&quot;);
});

RunTarget(target);
</code></pre>
<ul>
<li>Switch back to the Visual Editor, and you should see something that looks like the following:</li>
</ul>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2018/12/14/workflow-in-visual-editor.png" class="img-fluid" alt="Workflow in Visual Editor" /></p>
<ul>
<li>Make another change to the repository, and push the changes.  This will then trigger the workflow, and as a result, execute the action</li>
</ul>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2018/12/14/workflow-execution-start.png" class="img-fluid" alt="Workflow execution state" /></p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2018/12/14/workflow-execution-end.png" class="img-fluid" alt="Workflow execution end" /></p>
<ul>
<li>The action starts by downloading the Docker image that is required for it to execute the action, and then it executes the two Cake commands that are defined in the action.  i.e. <code>cake --version</code> followed by <code>cake ./build.cake --target=Default</code></li>
<li>We can then see the <code>Hello World!</code> being output within the Default task.</li>
</ul>
<h2 id="chaining-actions">Chaining Actions</h2>
<p>As shown in Brandon's image above, it would be possible to chain multiple cake actions together to form the entire workflow, with each one executing a particular task within the Cake script.  However, it is more likely that I would put this orchestration into the Cake script itself.  However, both options are definitely possible, so the choice is up to the end user.</p>
<h2 id="going-forward">Going forward</h2>
<p>As mentioned, some work is required to move this from a proof of concept to a hardened, re-usable, GitHub Action.  This will happen in due course, and the <code>cake-actions</code> repository will likely move under the cake-build Organisation on GitHub.</p>
<p>I really like the idea of defining my &quot;work&quot; in a Cake script, and then being able to re-use them in various repositories, triggered off of a number of different triggers.  There are currently <a href="https://developer.github.com/actions/creating-workflows/workflow-configuration-options/#events-supported-in-workflow-files">28 different events</a> that your workflow can trigger off.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2018/12/14/workflow-triggers.png" class="img-fluid" alt="Workflow Event Triggers" /></p>
<h2 id="overall-impression">Overall Impression</h2>
<p>Overall, I have to say that I am very impressed with GitHub Actions.  Things &quot;just&quot; worked, which is exactly what you want.  I can totally see how these small, precise actions, can be applied to the events being triggered on my repositories.  Right now, there are a number of manual steps for the Cake release process, and I can see a huge percentage of these being replaced with GitHub Actions.  I am very much looking forward to GitHub Actions coming out of beta.</p>


<div id="disqus_thread"></div>
<script type="text/javascript" src="/assets/js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2023 by Gary Ewan Park. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way. This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/gep13/gep13.github.io"><i class="fa fa-github"></i> This Site on GitHub</a> | <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
                </footer> 

                <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-41MC4W3E22"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-41MC4W3E22');
</script>
<script type="text/javascript" src="/assets/js/anchor.min.js"></script>
<script type="text/javascript" src="/assets/js/clipboard.min.js"></script>
<script type="text/javascript" src="/assets/js/anchor.js"></script>

                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

