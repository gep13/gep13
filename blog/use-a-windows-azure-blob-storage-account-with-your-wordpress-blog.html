
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Gary Ewan Park - Use a Windows Azure Blob Storage account with your WordPress blog</title>
        <meta name="description" content="Ramblings and Ponderings of a Microsoft Fan Boy..." />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Gary Ewan Park" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Gary Ewan Park" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Gary Ewan Park" />
        <meta name="msapplication-tooltip" content="Gary Ewan Park" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Gary Ewan Park - Use a Windows Azure Blob Storage account with your WordPress blog" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.gep13.co.uk/blog/use-a-windows-azure-blob-storage-account-with-your-wordpress-blog" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Gary Ewan Park</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li>
<li><a href="/talks">Talks</a></li>
<li><a href="/blog">Archive</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/tags">Tags</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Use a Windows Azure Blob Storage account with your WordPress blog</h1>
    <div class="meta">        
Published on 08 February 2012<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/azure" class="btn btn-default btn-xs">azure</a>
                    <a role="button" href="/tags/blob" class="btn btn-default btn-xs">blob</a>
                    <a role="button" href="/tags/storage-account" class="btn btn-default btn-xs">storage account</a>
                    <a role="button" href="/tags/wordpress" class="btn btn-default btn-xs">wordpress</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>Hot on the heels of the <a href="http://www.gep13.co.uk/blog/windows-azure-bootcamp-uk-tech-days">Windows Azure Bootcamp</a> that I did this weekend, I decided that I wanted to do <em>something</em> with Windows Azure, that way I could practice what I had learnt, and begin to increase my exposure to what Windows Azure brings to the table. I decided that I wanted to use the Windows Azure Blob Storage to host all of the static content of my WordPress Blog, thus, _hopefully, _increasing the performance of my blog. What follows is a list of instructions for setting up your WordPress Blog, as well as your Windows Azure account, and also your domain registrar (in order to apply a shortened domain name to your Blob Storage Account).</p>
<p>This article breaks down into three main parts:</p>
<ol>
<li>Set up your Blob Storage Account in the Windows Azure Portal, along with DNS settings for your Domain Registrar</li>
<li>Configure your Blob Storage Account using CloudXplorer</li>
<li>Set up a WordPress plugin to communicate with your Blob Storage Account</li>
</ol>
<p>So, let's get started!</p>
<h1 id="setting-up-windows-azure">Setting up Windows Azure</h1>
<ol>
<li><p>The first thing that you are going to need is a Windows Azure Account. If you don’t already have one, there are a couple of ways that you can get one:</p>
</li>
<li><p><a href="https://www.windowsazure.com/en-us/pricing/free-trial/">Windows Azure 3 Month Free Trial</a></p>
</li>
<li><p><a href="https://www.windowsazure.com/en-us/pricing/member-offers/msdn-benefits/">MSDN Subscribers can get Free Benefits</a></p>
</li>
<li><p><a href="https://www.windowsazure.com/en-us/pricing/purchase-options/">A number of different paid subscriptions</a></p>
</li>
<li><p>Once you have logged into your Windows Azure account, you will be presented with a huge selection of options, the scope of which are far out with the intention of this blog post, as a result, only the specific options to enable Blob Storage will be discussed here. Using the picture to the below as a guide, first select _Hosted Services, Storage Accounts &amp; CDN, Storage Accounts, _then <em>New Storage Account.</em></p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Create_New_Storage_Account.png" class="img-fluid" alt="Create New Storage Account" /></p>
</li>
<li><p>This will open the _Create a New Storage Account_dialog, where you will need to provide the details for the Storage Account that you would like to create.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Create_a_Storage_Account.png" class="img-fluid" alt="Create a Storage Account" /></p>
<p>The first of which is the URL that you would like to use. This needs to be unique across the entire Windows Azure infrastructure so you may need to get a little creative with your choice of name. You will be prompted with an error message if you enter something that isn’t allowed.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Error_-_dont_use_capitals.png" class="img-fluid" alt="Error Don't Use Capitals" /></p>
<p>The next piece of information is the <em>region or affinity group</em> that you want your Blob Storage Account to be located. Microsoft has several Data Centers located across the world, including Anywhere US, South Central US, Anywhere Europe, West Europe, Anywhere Asia, Southeast Asia, East Asia, North Central US, North Europe. Simply pick the region that makes most sense to your location. Click OK.</p>
</li>
<li><p>Your Storage Account will now get created. There will be a slight delay as your Account is first &quot;Creating...&quot;</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Storage_Account_Creating.png" class="img-fluid" alt="Storage Account Creating" /></p>
<p>Then &quot;Resolving DNS...&quot;</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Storage_Account_Resolving_DNS.png" class="img-fluid" alt="Storage Account Resolving DNS" /></p>
<p>But the end result will be your Storage Account will be &quot;Created&quot;</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Storage_Account_Created.png" class="img-fluid" alt="Storage Account Created" /></p>
</li>
<li><p>If you select your new Storage Account, on the right hand side of the Windows Azure Portal you will see all of the properties for this new Storage Account:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Storage_Account_Properties.png" class="img-fluid" alt="Storage Account Properties" /></p>
<p>The main ones of interest are the &quot;Keys&quot;, which we will use later to connect to the Blob Storage Account from WordPress, and the Blob URL. The Blob URL is the publicly routable URL for accessing your Blob Storage account. Any files you upload to the Blob Storage Account will be accessible using this URL as a prefix. As you can see though, this URL is slightly long, and when used in the context of existing website, say gep13.co.uk, it bears no relation to it. However, this is something we can change by applying a Custom Domain to the Storage Account.</p>
</li>
<li><p>Select your Storage Account, and then press <em>Add Domain</em>, as shown below:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Add_Custom_Domain.png" class="img-fluid" alt="Add Custom Domain" /></p>
</li>
<li><p>In the _Add a Custom Domain _Dialog, enter the domain name that you would like to use for this Storage Account. In my case, I wanted to use cdn.gep13.co.uk:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Add_Custom_Domain_Name.png" class="img-fluid" alt="Add Custom Domain Name" /></p>
<p>Press OK.</p>
</li>
<li><p>At this point, Windows Azure will begin to create the Custom Domain name:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Custom_Domain_Name_being_created.png" class="img-fluid" alt="Custom Domain Name being created" /></p>
</li>
<li><p>Once the initial process for the Custom Domain creation has completed, you will then have to validate that the domain name that you want to use actually belongs to you:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Validate_Custom_Domain_Name.png" class="img-fluid" alt="Validate Custom Domain Name" /></p>
<p>In order to do this, you will need to log into your Domain Registrar and alter the DNS Records for your domain to include a new CNAME record. The details for this record are provided for you, as per the above screenshot, so simply enter these details into your Domain Registrar site. As an example, this is what I had to do:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Add_Verify_Domain_to_Registrar.png" class="img-fluid" alt="Add Verify Domain to Registrar" /></p>
<p>Depending on how your Domain Registrar user interface works, remember to include the &quot;.&quot; at the end of the Canonical name, otherwise the DNS Record will not be accepted. Your new DNS record will take a while to propagate across the internet, so in the meantime, simply close the above <em>Validate Custom Domain</em> window, and you will see that your Custom Domain creation is in a _Pending _state:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Custom_Domain_Name_Pending.png" class="img-fluid" alt="Custom Domain Name Pending" /></p>
</li>
</ol>
<p>At this point, you might want to jump to Step 11.</p>
<ol>
<li><p>Once enough time has passed (I waited a couple of hours) return to the Windows Azure portal and select your domain and click Validate Domain:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Validate_Custom_Domain_Name_001.png" class="img-fluid" alt="Validate Custom Domain Name" /></p>
<p>If everything worked correctly you will see:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Domain_validated.png" class="img-fluid" alt="Domain Validated" /></p>
<p>However, depending on how long you waited, you might see this:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Validation_Failed.png" class="img-fluid" alt="Validation Failed" /></p>
<p>If you do, don’t worry, this simply means that the DNS Settings haven’t finished propagating, so try again later.</p>
</li>
<li><p>The only other thing left to do on this side of things is to create another CNAME record which will do the work of redirecting any requests to your Custom Domain, to your Blob Storage Account. All this means is that you need a CNAME record that has something like the following:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/CNAME_for_redirect.png" class="img-fluid" alt="CNAME for redirect" /></p>
<p>This is a redirect from the Custom Domain Name that you created, to the Blob URL for your storage account that was highlighted in Step 5 above. In order to say time, you might want to think about creating this CNAME record at the same time as you create the verify CNAME, that way you won’t have to wait a second lot of propagation time.</p>
</li>
</ol>
<h1 id="configure-your-blob-storage-account">Configure your Blob Storage Account</h1>
<ol>
<li><p>Now that the Blob Storage Account has been created, and Custom Domain established, we have a little bit of work to do in order to first configure the Blob Storage Account for use. It is easiest to do this using a 3rd Party Tool. There are a couple of main ones out there, the first being from <a href="http://cerebrata.com/">Redgate</a> (who acquired Cerebrata) and you can get a trial version of their software, and also <a href="http://clumsyleaf.com/products/cloudxplorer">CloudXplorer from ClumsyLeaf</a>. For the purposes of this walk through, I will be using CloudXplorer, so go ahead and get that installed.</p>
</li>
<li><p>Open CloudXplorer and select File | Accounts and the _Manage accounts_window opens:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Manage_Accounts.png" class="img-fluid" alt="Manage Accounts" /></p>
</li>
<li><p>Click the New... button and then select Windows Azure Account... and the _Windows Azure account _window will open:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/New_Windows_Azure_Account.png" class="img-fluid" alt="New Windows Azure Account" /></p>
</li>
<li><p>Using the information from step 5 above, enter the details of the Blob Storage Account that we created, where &quot;Secret Key:&quot; equates to the &quot;Primary Access Key&quot; (simply click View button to bring this up) and Name: is the Name of your Blob Storage Account, i.e. in my case gep13wpstorage.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Windows_Azure_Account_Window.png" class="img-fluid" alt="Windows Azure Account Window" /></p>
</li>
<li><p>With the account in place, the first thing we need to do is to create a container within the Blob Storage Account. This will let us compartmentalise files into the correct location. Right click in the right hand window of CloudXplorer and select New | Container...</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/CloudXplorer_Create_Container.png" class="img-fluid" alt="CloudXplorer Create Container" /></p>
</li>
<li><p>In the _Create directory/container _window, enter the name for your container. I went for &quot;myuploads&quot;.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Create_New_Container.png" class="img-fluid" alt="Create New Container" /></p>
</li>
<li><p>Now we need to set the properties of the container to allow public access. Right click on the container that you just created and select Properties.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Container_Properties.png" class="img-fluid" alt="Container Properties" /></p>
</li>
<li><p>In the myloads Properties window, select the Policies tab and then select &quot;<em>Full public read access</em>&quot; in the Access control drop down list, then select ok.</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/Container_Policies.png" class="img-fluid" alt="Container Policies" /></p>
</li>
</ol>
<h1 id="configure-wordpress">Configure WordPress</h1>
<p>At this point, you have a number of options to set up your WordPress site to use Windows Azure as it’s repository for static content. Microsoft have actually released their own WordPress plugin which does just that. If you are interested, you can find this <a href="http://wordpress.org/extend/plugins/windows-azure-storage/">here</a>. I ended up not using this particular plugin. As far as I could see, the onus was on you to manually move the files into your Azure container. Now, this isn’t hard to do, using the CloudXplorer I showed earlier, files can easily be copied into the container, but I wanted something a little more integrated.</p>
<p>I ended up using the excellent W3 Total Cache plugin which you can find <a href="http://wordpress.org/extend/plugins/w3-total-cache/">here</a>. Again, the complete setup and configuration of this plugin is out with the scope of this particular blog post (I might write another one on this), however, the main thing to know is that there are a number of potential endpoints for this plugin including:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/W3TC_CDN_Options.png" class="img-fluid" alt="W3TC CDN Options" /></p>
<p>As you will see, I have chosen Microsoft Azure Storage. From there, you can then specify the options for connecting to Windows Azure:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/CDN_Settings.png" class="img-fluid" alt="CDN Settings" /></p>
<p>Including the Custom Domain name which we set up earlier (if you can remember that far back).</p>
<p>With that in place, you can then use the W3 Total Cache plugin to move all the necessary files into your Blob Storage Account. You can simply click on each of the required buttons:</p>
<p><img src="https://gep13wpstorage.blob.core.windows.net/gep13/2012/2/8/General_Settings.png" class="img-fluid" alt="General Settings" /></p>
<p>Then, with all the files uploaded, and W3 Total Cache activated, it will rewrite all of the URL’s for all of your static content to come from your Blob Storage Account. Feel free to take a look and see this in action by right clicking on the view source of this page, and searching for cdn.gep13.co.uk.</p>
<p>And that, as they say, is that! If you have any questions, please feel free to get in touch.</p>


<div id="disqus_thread"></div>
<script type="text/javascript" src="/assets/js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2021 by Gary Ewan Park. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way. This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/gep13/gep13.github.io"><i class="fa fa-github"></i> This Site on GitHub</a> | <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
                </footer> 

                <script type="text/javascript" src="/assets/js/google.js"></script>
<script type="text/javascript" src="/assets/js/anchor.min.js"></script>
<script type="text/javascript" src="/assets/js/clipboard.min.js"></script>
<script type="text/javascript" src="/assets/js/anchor.js"></script>

                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

