
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Gary Ewan Park - Introducing Cake.Chocolatey.Module</title>
        <meta name="description" content="Ramblings and Ponderings of a Microsoft Fan Boy..." />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Gary Ewan Park" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Gary Ewan Park" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Gary Ewan Park" />
        <meta name="msapplication-tooltip" content="Gary Ewan Park" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Gary Ewan Park - Introducing Cake.Chocolatey.Module" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://www.gep13.co.uk/blog/introducing-cake.chocolatey.module" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Gary Ewan Park</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li>
<li><a href="/talks">Talks</a></li>
<li><a href="/blog">Archive</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/tags">Tags</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Introducing Cake.Chocolatey.Module</h1>
    <div class="meta">        
Published on 18 March 2017<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/automation" class="btn btn-default btn-xs">automation</a>
                    <a role="button" href="/tags/build" class="btn btn-default btn-xs">build</a>
                    <a role="button" href="/tags/cake" class="btn btn-default btn-xs">cake</a>
                    <a role="button" href="/tags/cake-contrib" class="btn btn-default btn-xs">cake-contrib</a>
                    <a role="button" href="/tags/chocolatey" class="btn btn-default btn-xs">chocolatey</a>
                    <a role="button" href="/tags/modules" class="btn btn-default btn-xs">modules</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h1 id="or-as-i-like-to-call-it">Or as I like to call it...</h1>
<p>The Chocolatey Cake Module!</p>
<h1 id="what-is-it">What is it?</h1>
<p>Back in version <a href="https://github.com/cake-build/cake/releases/tag/v0.13.0">0.13.0</a> of Cake a feature known as <a href="https://github.com/cake-build/cake/issues/646">Module Support</a> was released.  This provided the ability to both extend and replace some of the built in functionality of Cake.</p>
<p>One of these extension points is the registration of <a href="http://cakebuild.net/api/Cake.Core.Packaging/IPackageInstaller/">IPackageInstaller</a>'s, which deal with installing tools and addins during the Cake Script execution.  The Chocolatey Cake Module provide the extension point to allow tools to be resolved using Chocolatey.</p>
<p><strong>NOTE:</strong> Chocolatey deals with the installation of applications.  As a result, it only makes sense for this module to deal with tools, and not addins.</p>
<h1 id="why-is-this-needed">Why is this needed?</h1>
<p>Out of the box, Cake has the ability to install tools and addins from any NuGet source.  This is documented on the <a href="http://cakebuild.net/docs/fundamentals/preprocessor-directives">Cake Website</a>.  Recently, <a href="https://github.com/larzw">Larz White</a> <a href="http://cakebuild.net/blog/2017/01/cake-paket">showed</a> how it was possible to use an alternative package manager, namely <a href="https://fsprojects.github.io/Paket/">Paket</a> to install those tools and addins.</p>
<p>However, not all tools that you require for your build may be available as NuGet Packages.  This leaves you with two options (there are likely more, but for the purposes of this discussion, let's stick to two), you could either pre-install the required tools onto the build machine that you are using, or look to install those tools through a custom script, perhaps through something like <a href="https://chocolatey.org/">Chocolatey</a>.</p>
<p>When I joined the Cake Team, one of the first things that I did was to add <a href="http://cakebuild.net/dsl/chocolatey/">Chocolatey Aliases</a> to Cake, so you have always been able to install Chocolatey packages as part of your build process, using something like this:</p>
<pre><code>ChocolateyInstall(&quot;MyChocolateyPackage&quot;);
</code></pre>
<p>For me, that removes an element of clarity over what tooling is required for the build.  I would much rather see all of the dependencies in one place, i.e. here:</p>
<pre><code>///////////////////////////////////////////////////////////////////////////////
// TOOLS
///////////////////////////////////////////////////////////////////////////////

#tool nuget:?package=coveralls.io&amp;version=1.3.4
#tool nuget:?package=gitreleasemanager&amp;version=0.5.0
#tool nuget:?package=GitVersion.CommandLine&amp;version=3.6.2
#tool nuget:?package=JetBrains.ReSharper.CommandLineTools&amp;version=2016.3.20161223.160402
#tool nuget:?package=ReSharperReports&amp;version=0.2.0
#tool nuget:?package=KuduSync.NET&amp;version=1.3.1
#tool nuget:?package=Wyam&amp;version=0.16.1
#tool nuget:?package=gitlink&amp;version=2.4.1
#tool nuget:?package=MSBuild.Extension.Pack&amp;version=1.9.0
</code></pre>
<p>Along with all the other tools that I use in my build.</p>
<p>And that is what this Cake Module allows you to do.  You can now add the following:</p>
<pre><code>#tool choco:?package=nodejs.install&amp;version=7.7.3
</code></pre>
<p>Which would install version 7.7.3 of the <a href="https://chocolatey.org/packages/nodejs.install">node.install package from chocolatey.org</a>.</p>
<h1 id="installation">Installation</h1>
<p>Due to the fact that Cake Modules are extending and altering the internals of the Cake, the Module Assembly needs to be loaded prior to the main Cake execution.  As a result, the only place that this can really happen is during the bootstrapping phase.  If you use the <a href="https://github.com/cake-build/resources/commit/3d112812353d714dad142c41f170b949f4a2eb2f">latest version of the default bootstrapper</a> this process is made very easy.  All you need to do is the following.</p>
<ol>
<li>Add a modules folder into your tools folder</li>
<li>Add a packages.config file into the newly created modules folder</li>
<li>Add the name and version of the Module that you want to use.  <strong>NOTE:</strong> At this point, the assumption is that you are hosting the Module on NuGet.org.  If this is not the case, then additional steps would be required.</li>
<li>An example packages.config file is shown below:</li>
</ol>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;packages&gt;
	&lt;package id=&quot;Cake.Chocolatey.Module&quot; version=&quot;0.1.0&quot; /&gt;
&lt;/packages&gt;
</code></pre>
<ol start="5">
<li>Run the build as normal.  During the Cake Execution, it will recognise the Module Assembly which as been restored into the <code>tools/modules</code> folder, and load it.</li>
</ol>
<p><strong>NOTE:</strong> Similar to the recommendation <a href="http://cakebuild.net/docs/tutorials/getting-started">here</a> regarding only checking in your packages.config and not the entire contents of the Cake tools folder, the same recommendation is applied here.  Only check-in the packages.config file in the modules folder, and not the entire contents.</p>
<h1 id="usage">Usage</h1>
<p>As mentioned above, installing a tool using the Chocolatey Cake Module is as simple as:</p>
<pre><code>#tool choco:?package=nodejs.install&amp;version=7.7.3
</code></pre>
<p>If the tool in question comes from a different source, you can change that as follows:</p>
<pre><code>#tool choco:https://www.myget.org/F/gep13/api/v2?package=gep13.gitConfig&amp;version=1.0.6
</code></pre>
<p>In this version 0.1.0 release of the Chocolatey Cake Module you can also specify whether the package in question is a pre-release or not:</p>
<pre><code>#tool choco:?package=packageA&amp;prerelease
</code></pre>
<p>Future versions of the Chocolatey Cake Module will include additional options for installing the package, including things like <code>--forcex86</code>, <code>--install-arguments</code>, <code>--package-parameters</code>, etc.  This initial release includes just the very basic of installation functionality.</p>
<h1 id="documentation">Documentation</h1>
<p>You can find additional documentation for this module here:</p>
<p><a href="https://cake-contrib.github.io/Cake.Chocolatey.Module/">https://cake-contrib.github.io/Cake.Chocolatey.Module/</a></p>
<h1 id="source-code">Source Code</h1>
<p>The source code for this Module can be found here:</p>
<p><a href="https://github.com/cake-contrib/Cake.Chocolatey.Module">https://github.com/cake-contrib/Cake.Chocolatey.Module</a></p>
<h2 id="chat-room">Chat Room</h2>
<p>If you have any questions about this Module, then please feel to drop into the Gitter Chat room for all the addins and modules which exist in the <a href="https://github.com/cake-contrib">cake-contrib organisation</a> on GitHub:</p>
<p><a href="https://gitter.im/cake-contrib/Lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/cake-contrib/Lobby.svg" class="img-fluid" alt="Join the chat at https://gitter.im/cake-contrib/Lobby" /></a></p>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'gep13'; // required: replace example with your forum shortname
    var disqus_identifier = 'http://www.gep13.co.uk/blog/introducing-cake.chocolatey.module' + 'S/';
    var disqus_title = 'Introducing Cake.Chocolatey.Module';
    var disqus_url = 'http://www.gep13.co.uk/blog/introducing-cake.chocolatey.module' + '/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/gep13">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Copyright © 2019 by Gary Ewan Park. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way. This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/gep13/gep13.github.io"><i class="fa fa-github"></i> This Site on GitHub</a> | <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
                </footer> 

                <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'gep13'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

    // Google Analytics
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-20926037-1', 'auto');
    ga('send', 'pageview');
</script>

<script type="text/javascript" src="/assets/js/anchor.min.js"></script>
<script type="text/javascript" src="/assets/js/clipboard.min.js"></script>
<script type="text/javascript">
    anchors.options.placement = 'left';
    anchors.add();

    var snippets = document.querySelectorAll("pre > code");
    [].forEach.call(snippets, function(snippet) {
        snippet.insertAdjacentHTML("beforebegin", "<button class='btn-copy' data-clipboard-snippet><img class='clippy' width=13 src='/assets/images/clippy.svg' alt='Copy to clipboard'></button>");
    });
    var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
        target: function(trigger) {
            return trigger.nextElementSibling;
        }
    });
    clipboardSnippets.on('success', function(e) {
        e.clearSelection();
        showTooltip(e.trigger, "Copied!");
    });
    clipboardSnippets.on('error', function(e) {
        showTooltip(e.trigger, fallbackMessage(e.action));
    });
</script>
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

